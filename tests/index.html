<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Social Post Component Tests</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f5f5f5;
      }
      .test-section {
        background: white;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        border: 1px solid #ddd;
      }
      .test-result {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .test-pass {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .test-fail {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Social Post Component Tests</h1>

    <div class="test-section">
      <h2>Basic Functionality Tests</h2>
      <div id="basic-tests"></div>
    </div>

    <div class="test-section">
      <h2>Attribute Tests</h2>
      <div class="test-grid">
        <social-post
          id="test-post-1"
          username="testuser"
          display-name="Test User"
          avatar="https://via.placeholder.com/40"
          timestamp="1h ago"
          content="This is a test post to verify attributes work correctly."
          likes="25"
          theme="light"
        >
        </social-post>
      </div>
      <div id="attribute-tests"></div>
    </div>

    <div class="test-section">
      <h2>JavaScript Property Tests</h2>
      <div class="test-grid">
        <social-post id="test-post-2"></social-post>
      </div>
      <div id="property-tests"></div>
    </div>

    <div class="test-section">
      <h2>Method Tests</h2>
      <div class="test-grid">
        <social-post
          id="test-post-3"
          username="methodtest"
          display-name="Method Test"
          content="Testing methods..."
          likes="0"
          theme="light"
        >
        </social-post>
      </div>
      <div id="method-tests"></div>
    </div>

    <div class="test-section">
      <h2>Theme Tests</h2>
      <div class="test-grid">
        <social-post
          id="test-post-4"
          username="themetest"
          display-name="Theme Test"
          content="Testing light theme"
          theme="light"
        >
        </social-post>
        <social-post
          id="test-post-5"
          username="themetest"
          display-name="Theme Test"
          content="Testing dark theme"
          theme="dark"
        >
        </social-post>
      </div>
      <div id="theme-tests"></div>
    </div>

    <div class="test-section">
      <h2>Content Truncation Tests</h2>
      <div class="test-grid">
        <social-post
          id="test-post-6"
          username="longcontent"
          display-name="Long Content Test"
          content="This is a very long piece of content that should be truncated after three lines. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur."
          theme="light"
        >
        </social-post>
      </div>
      <div id="truncation-tests"></div>
    </div>

    <script type="module" src="../src/social-post.js"></script>
    <script>
      // Test utilities
      function runTest(name, testFn) {
        try {
          const result = testFn();
          return { name, passed: result, error: null };
        } catch (error) {
          return { name, passed: false, error: error.message };
        }
      }

      function displayTest(result, containerId) {
        const container = document.getElementById(containerId);
        const div = document.createElement("div");
        div.className = result.passed
          ? "test-result test-pass"
          : "test-result test-fail";
        div.innerHTML = `
                <strong>${result.passed ? "‚úÖ" : "‚ùå"} ${result.name}</strong>
                ${
                  result.error
                    ? `<br><small>Error: ${result.error}</small>`
                    : ""
                }
            `;
        container.appendChild(div);
      }

      // Wait for components to be defined
      customElements.whenDefined("social-post").then(() => {
        runAllTests();
      });

      function runAllTests() {
        // Basic functionality tests
        const basicTests = [
          runTest("Component is defined", () => {
            return customElements.get("social-post") !== undefined;
          }),
          runTest("Shadow DOM is attached", () => {
            const post = document.createElement("social-post");
            return post.shadowRoot !== null;
          }),
          runTest("Component renders without errors", () => {
            const post = document.createElement("social-post");
            document.body.appendChild(post);
            const hasContent = post.shadowRoot.innerHTML.length > 0;
            document.body.removeChild(post);
            return hasContent;
          }),
        ];

        basicTests.forEach((test) => displayTest(test, "basic-tests"));

        // Attribute tests
        const testPost1 = document.getElementById("test-post-1");
        const attributeTests = [
          runTest("Username attribute works", () => {
            return testPost1.username === "testuser";
          }),
          runTest("Display name attribute works", () => {
            return testPost1.displayName === "Test User";
          }),
          runTest("Likes attribute works", () => {
            return testPost1.likes === 25;
          }),
          runTest("Theme attribute works", () => {
            return testPost1.theme === "light";
          }),
          runTest("Content renders in shadow DOM", () => {
            const content = testPost1.shadowRoot.querySelector(".post-content");
            return (
              content && content.textContent.includes("This is a test post")
            );
          }),
        ];

        attributeTests.forEach((test) => displayTest(test, "attribute-tests"));

        // Property tests
        const testPost2 = document.getElementById("test-post-2");
        const propertyTests = [
          runTest("Username property setter works", () => {
            testPost2.username = "proptest";
            return testPost2.username === "proptest";
          }),
          runTest("Display name property setter works", () => {
            testPost2.displayName = "Property Test";
            return testPost2.displayName === "Property Test";
          }),
          runTest("Likes property setter works", () => {
            testPost2.likes = 50;
            return testPost2.likes === 50;
          }),
          runTest("Theme property setter works", () => {
            testPost2.theme = "dark";
            return testPost2.theme === "dark";
          }),
          runTest("Content property setter works", () => {
            testPost2.content = "Property test content";
            return testPost2.content === "Property test content";
          }),
        ];

        propertyTests.forEach((test) => displayTest(test, "property-tests"));

        // Method tests
        const testPost3 = document.getElementById("test-post-3");
        const methodTests = [
          runTest("incrementLikes() method works", () => {
            const initialLikes = testPost3.likes;
            testPost3.incrementLikes();
            return testPost3.likes === initialLikes + 1;
          }),
          runTest("setTheme() method works", () => {
            testPost3.setTheme("dark");
            return testPost3.theme === "dark";
          }),
          runTest("Like button click increments likes", () => {
            const initialLikes = testPost3.likes;
            const likeButton =
              testPost3.shadowRoot.querySelector(".like-button");
            likeButton.click();
            return testPost3.likes === initialLikes + 1;
          }),
        ];

        methodTests.forEach((test) => displayTest(test, "method-tests"));

        // Theme tests
        const testPost4 = document.getElementById("test-post-4");
        const testPost5 = document.getElementById("test-post-5");
        const themeTests = [
          runTest("Light theme applies correct styles", () => {
            const container =
              testPost4.shadowRoot.querySelector(".post-container");
            const computedStyle = getComputedStyle(container);
            return computedStyle.backgroundColor.includes("255"); // White background
          }),
          runTest("Dark theme applies correct styles", () => {
            const container =
              testPost5.shadowRoot.querySelector(".post-container");
            const computedStyle = getComputedStyle(container);
            return !computedStyle.backgroundColor.includes("255"); // Non-white background
          }),
          runTest("Theme switcher button exists", () => {
            const switcher =
              testPost4.shadowRoot.querySelector(".theme-switcher");
            return switcher !== null;
          }),
        ];

        themeTests.forEach((test) => displayTest(test, "theme-tests"));

        // Truncation tests
        const testPost6 = document.getElementById("test-post-6");
        const truncationTests = [
          runTest("Long content triggers truncation", () => {
            return testPost6.isContentTruncated();
          }),
          runTest("See more button appears for long content", () => {
            const seeMoreButton =
              testPost6.shadowRoot.querySelector(".see-more-button");
            return seeMoreButton !== null;
          }),
          runTest("Truncated content is shorter than original", () => {
            const displayContent = testPost6.getDisplayContent();
            return displayContent.length < testPost6.content.length;
          }),
        ];

        truncationTests.forEach((test) =>
          displayTest(test, "truncation-tests")
        );

        // Display summary
        setTimeout(() => {
          const allTests = document.querySelectorAll(".test-result");
          const passedTests = document.querySelectorAll(".test-pass");
          const failedTests = document.querySelectorAll(".test-fail");

          const summary = document.createElement("div");
          summary.className = "test-section";
          summary.innerHTML = `
                    <h2>üìä Test Summary</h2>
                    <p><strong>Total Tests:</strong> ${allTests.length}</p>
                    <p><strong>Passed:</strong> ${passedTests.length}</p>
                    <p><strong>Failed:</strong> ${failedTests.length}</p>
                    <p><strong>Success Rate:</strong> ${Math.round(
                      (passedTests.length / allTests.length) * 100
                    )}%</p>
                `;
          document.body.insertBefore(
            summary,
            document.body.firstChild.nextSibling
          );
        }, 100);
      }
    </script>
  </body>
</html>
